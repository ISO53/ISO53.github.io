// ******************** Declare Variables ********************
const exampleProject = {
	id: 652569528,
	node_id: "R_kgDOJuVruA",
	name: "Backgammon-Game-Server-and-Client",
	full_name: "ISO53/Backgammon-Game-Server-and-Client",
	private: false,
	owner: {
		login: "ISO53",
		id: 102249575,
		node_id: "U_kgDOBhg0Zw",
		avatar_url: "https://avatars.githubusercontent.com/u/102249575?v=4",
		gravatar_id: "",
		url: "https://api.github.com/users/ISO53",
		html_url: "https://github.com/ISO53",
		followers_url: "https://api.github.com/users/ISO53/followers",
		following_url: "https://api.github.com/users/ISO53/following{/other_user}",
		gists_url: "https://api.github.com/users/ISO53/gists{/gist_id}",
		starred_url: "https://api.github.com/users/ISO53/starred{/owner}{/repo}",
		subscriptions_url: "https://api.github.com/users/ISO53/subscriptions",
		organizations_url: "https://api.github.com/users/ISO53/orgs",
		repos_url: "https://api.github.com/users/ISO53/repos",
		events_url: "https://api.github.com/users/ISO53/events{/privacy}",
		received_events_url: "https://api.github.com/users/ISO53/received_events",
		type: "User",
		site_admin: false,
	},
	html_url: "https://github.com/ISO53/Backgammon-Game-Server-and-Client",
	description:
		"This project consists of a Java server that provides a multiplayer Backgammon game functionality, allowing clients to connect to a room and engage in interactive gameplay, with the client-side implemented using Electron.js.",
	fork: false,
	url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client",
	forks_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/forks",
	keys_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/keys{/key_id}",
	collaborators_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/collaborators{/collaborator}",
	teams_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/teams",
	hooks_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/hooks",
	issue_events_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/issues/events{/number}",
	events_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/events",
	assignees_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/assignees{/user}",
	branches_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/branches{/branch}",
	tags_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/tags",
	blobs_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/git/blobs{/sha}",
	git_tags_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/git/tags{/sha}",
	git_refs_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/git/refs{/sha}",
	trees_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/git/trees{/sha}",
	statuses_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/statuses/{sha}",
	languages_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/languages",
	stargazers_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/stargazers",
	contributors_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/contributors",
	subscribers_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/subscribers",
	subscription_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/subscription",
	commits_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/commits{/sha}",
	git_commits_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/git/commits{/sha}",
	comments_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/comments{/number}",
	issue_comment_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/issues/comments{/number}",
	contents_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/contents/{+path}",
	compare_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/compare/{base}...{head}",
	merges_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/merges",
	archive_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/{archive_format}{/ref}",
	downloads_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/downloads",
	issues_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/issues{/number}",
	pulls_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/pulls{/number}",
	milestones_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/milestones{/number}",
	notifications_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/notifications{?since,all,participating}",
	labels_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/labels{/name}",
	releases_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/releases{/id}",
	deployments_url: "https://api.github.com/repos/ISO53/Backgammon-Game-Server-and-Client/deployments",
	created_at: "2023-06-12T10:42:59Z",
	updated_at: "2023-08-31T13:03:27Z",
	pushed_at: "2023-06-12T11:22:39Z",
	git_url: "git://github.com/ISO53/Backgammon-Game-Server-and-Client.git",
	ssh_url: "git@github.com:ISO53/Backgammon-Game-Server-and-Client.git",
	clone_url: "https://github.com/ISO53/Backgammon-Game-Server-and-Client.git",
	svn_url: "https://github.com/ISO53/Backgammon-Game-Server-and-Client",
	homepage: null,
	size: 7994,
	stargazers_count: 1,
	watchers_count: 1,
	language: "Java",
	has_issues: true,
	has_projects: true,
	has_downloads: true,
	has_wiki: true,
	has_pages: false,
	has_discussions: false,
	forks_count: 0,
	mirror_url: null,
	archived: false,
	disabled: false,
	open_issues_count: 0,
	license: {
		key: "gpl-3.0",
		name: "GNU General Public License v3.0",
		spdx_id: "GPL-3.0",
		url: "https://api.github.com/licenses/gpl-3.0",
		node_id: "MDc6TGljZW5zZTk=",
	},
	allow_forking: true,
	is_template: false,
	web_commit_signoff_required: false,
	topics: [],
	visibility: "public",
	forks: 0,
	open_issues: 0,
	watchers: 1,
	default_branch: "master",
};
let PROJECTS;
let LANGUAGES = {};
let TAGS = {};
let LIST_SIZE;

// ************************ JS Starts ************************
loadProjects();
firstLoadAnimations();
interactiveProjectsScrollBar();

// ******************** Declare Functions ********************
function firstLoadAnimations() {
	let header = document.getElementById("header");
	let secondaryHeader = document.getElementById("secondary_header");
	let paragraph = document.getElementById("main_paragraph");
	let buttons = document.getElementById("button_div");
	let projectsDiv = document.getElementById("list_wrapper");

	setTimeout(() => header.classList.remove("hide_only_opacity"), 250);
	setTimeout(() => secondaryHeader.classList.remove("hide"), 500);
	setTimeout(() => paragraph.classList.remove("hide"), 750);
	setTimeout(() => buttons.classList.remove("hide"), 1000);
	setTimeout(() => projectsDiv.classList.remove("hide"), 1000);
	setTimeout(() => (projectsDiv.style.transform = "perspective(300px) rotateY(-10deg)"), 1250);
}

function loadProjects() {
	const apiUrl = "https://api.github.com/users/iso53/repos";

	fetch(apiUrl)
		.then((response) => {
			if (!response.ok) {
				throw new Error(`GitHub API request failed with status: ${response.status}`);
			}
			return response.json();
		})
		.then((data) => (PROJECTS = data) && loadEachProject(data))
		.catch((error) => console.error("Error:", error));

	function loadEachProject(projects) {
		let projectsDiv = document.getElementById("list_div");
		LIST_SIZE = projects.length;

		projects.forEach((project) => {
			// Load language
			fetch(project.languages_url)
				.then((response) => response.json())
				.then((data) => (LANGUAGES[project.id] = data))
				.catch((error) => console.error("Error:", error));

			// Load tags
			fetch(project.tags_url)
				.then((response) => response.json())
				.then((data) => (TAGS[project.id] = data))
				.catch((error) => console.error("Error:", error));

			// Main div for each project
			let projectDiv = document.createElement("div");
			projectDiv.className = "slider_box";
			projectsDiv.appendChild(projectDiv);

			// Top div for repo name and state
			let topDiv = document.createElement("div");
			topDiv.className = "project_top_div";
			projectDiv.appendChild(topDiv);

			// H2 element for repo name
			let repoName = document.createElement("h2");
			repoName.innerHTML = project.name.replace(/-/g, " ");
			repoName.className = "project_name";
			topDiv.appendChild(repoName);

			// Public / private tag
			let tag = document.createElement("span");
			tag.innerHTML = project.private === true ? "Private" : "Public";
			tag.className = "tag";
			topDiv.appendChild(tag);

			// Middle div for repo description
			let middleDiv = document.createElement("div");
			middleDiv.className = "project_middle_div";
			projectDiv.appendChild(middleDiv);

			// Readme
			let description = document.createElement("p");
			description.innerHTML = project.description;
			description.className = "project_desc";
			middleDiv.appendChild(description);

			// Bottom div for project details
			let bottomDiv = document.createElement("div");
			bottomDiv.className = "project_bottom_div";
			projectDiv.appendChild(bottomDiv);

			// Language
			let lang = document.createElement("h3");
			lang.className = "project_lang";
			lang.innerHTML = project.language;
			bottomDiv.appendChild(lang);

			// Stargazers image
			let stars = document.createElement("img");
			stars.className = "project_stars";
			stars.src = "res/star.svg";
			bottomDiv.appendChild(stars);

			// Stargazers count
			let starsCount = document.createElement("h3");
			starsCount.className = "project_stars_count";
			starsCount.innerHTML = project.stargazers_count;
			bottomDiv.appendChild(starsCount);

			if (project.license !== null) {
				// License image
				let license = document.createElement("img");
				license.className = "project_license";
				license.src = "res/license.svg";
				bottomDiv.appendChild(license);

				// License name
				let licenseName = document.createElement("h3");
				licenseName.className = "project_license_name";
				licenseName.innerHTML = project.license.name;
				bottomDiv.appendChild(licenseName);
			}
		});
	}
}

function interactiveProjectsScrollBar() {
	let up = document.getElementById("up");
	let down = document.getElementById("down");
	let list = document.getElementById("list_div");
	let wrapper = document.getElementById("list_wrapper");

	const step = 150 + 25; // 150px height + 50px margin
	const startPos = wrapper.offsetHeight / 2 - step / 2 - 12.5;

	let current = startPos;
	let index = 0;

	list.style.transform = "translateY(" + current + "px)";
	adjustOtherDivs();

	up.addEventListener("click", () => {
		if (index - 1 >= 0) {
			current += step;
			list.style.transform = "translateY(" + current + "px)";
			index--;

			adjustOtherDivs();
			loadNewproject("up");
		}
	});

	down.addEventListener("click", () => {
		if (index + 1 < LIST_SIZE) {
			current -= step;
			list.style.transform = "translateY(" + current + "px)";
			index++;

			adjustOtherDivs();
			loadNewproject("down");
		}
	});

	function adjustOtherDivs() {
		for (let i = 0; i < list.children.length; i++) {
			list.children[i].style.transform = "none";
			list.children[i].style.opacity = "1";
		}

		if (index + 1 < LIST_SIZE) {
			list.children[index + 1].style.transform = "scale(90%)";
			list.children[index + 1].style.opacity = "60%";
		}

		if (index - 1 >= 0) {
			list.children[index - 1].style.transform = "scale(90%)";
			list.children[index - 1].style.opacity = "60%";
		}

		if (index + 2 < LIST_SIZE) {
			list.children[index + 2].style.transform = "scale(80%)";
			list.children[index + 2].style.opacity = "20%";
		}

		if (index - 2 >= 0) {
			list.children[index - 2].style.transform = "scale(80%)";
			list.children[index - 2].style.opacity = "20%";
		}
	}

	function loadNewproject(direction) {
		let infoDiv = document.getElementById("information_div");
		let secondaryHeader = document.getElementById("secondary_header");
		let mainParagraph = document.getElementById("main_paragraph");
		let languagesDiv = document.getElementById("project_languages_div");
		let otherDetailsDiv = document.getElementById("project_other_details_div");
		let tagsDiv = document.getElementById("projects_tags_div");

		infoDiv.style.transform = "translateY(" + (direction === "up" ? "+" : "-") + "15%)";
		infoDiv.style.opacity = "0";

		setTimeout(() => {
			// Header
			secondaryHeader.innerHTML = PROJECTS[index].full_name.replace(/-/g, " ") + "<h4 id='arrow'>➚</h4>";
			secondaryHeader.setAttribute("href", PROJECTS[index].html_url);
			mainParagraph.innerHTML = PROJECTS[index].description;

			// Languages
			languagesDiv.innerHTML = "";
			let total = 0;
			Object.keys(LANGUAGES[PROJECTS[index].id]).forEach((key) => (total += LANGUAGES[PROJECTS[index].id][key]));

			Object.keys(LANGUAGES[PROJECTS[index].id]).forEach((key) => {
				let value = LANGUAGES[PROJECTS[index].id][key];
				console.log(total, value, (100 * value) / total);

				let langDiv = document.createElement("div");
				langDiv.className = "lang_div";
				languagesDiv.appendChild(langDiv);

				let langInnerDiv = document.createElement("div");
				langInnerDiv.className = "lang_inner_div";
				langDiv.appendChild(langInnerDiv);

				let langLevel = document.createElement("div");
				langLevel.className = "lang_level";
				langLevel.style.width = (100 * value) / total + "px";
				langInnerDiv.appendChild(langLevel);

				let lang = document.createElement("h4");
				lang.className = "language";
				lang.innerHTML = key;
				langDiv.appendChild(lang);
			});

			// Other details
			otherDetailsDiv.innerHTML = "";

			// Last Updated
			let lastUpdatedDiv = document.createElement("div");
			lastUpdatedDiv.className = "detail_div";
			otherDetailsDiv.appendChild(lastUpdatedDiv);

			let lastUpdateLogo = document.createElement("img");
			lastUpdateLogo.src = "res/date.svg";
			lastUpdateLogo.className = "details_logo";
			lastUpdatedDiv.appendChild(lastUpdateLogo);

			let lastUpdateDate = document.createElement("h4");
			lastUpdateDate.className = "details_text";
			lastUpdateDate.innerHTML = formatDate(PROJECTS[index].updated_at);
			lastUpdatedDiv.appendChild(lastUpdateDate);

			// License
			let licenseDiv = document.createElement("div");
			licenseDiv.className = "detail_div";
			otherDetailsDiv.appendChild(licenseDiv);

			let licenseLogo = document.createElement("img");
			licenseLogo.src = "res/license.svg";
			licenseLogo.className = "details_logo";
			licenseDiv.appendChild(licenseLogo);

			let licenseName = document.createElement("h4");
			licenseName.className = "details_text";
			licenseName.innerHTML = PROJECTS[index].license === null ? "No License" : PROJECTS[index].license.name;
			licenseDiv.appendChild(licenseName);

			// Stars
			let starsDiv = document.createElement("div");
			starsDiv.className = "detail_div";
			otherDetailsDiv.appendChild(starsDiv);

			let starsLogo = document.createElement("img");
			starsLogo.src = "res/star.svg";
			starsLogo.className = "details_logo";
			starsDiv.appendChild(starsLogo);

			let starCount = document.createElement("h4");
			starCount.className = "details_text";
			starCount.innerHTML = PROJECTS[index].stargazers_count;
			starsDiv.appendChild(starCount);

			// Watchers
			let watchersDiv = document.createElement("div");
			watchersDiv.className = "detail_div";
			otherDetailsDiv.appendChild(watchersDiv);

			let watchersLogo = document.createElement("img");
			watchersLogo.src = "res/eye.svg";
			watchersLogo.className = "details_logo";
			watchersDiv.appendChild(watchersLogo);

			let watchersCount = document.createElement("h4");
			watchersCount.className = "details_text";
			watchersCount.innerHTML = PROJECTS[index].watchers_count;
			watchersDiv.appendChild(watchersCount);

			// Tags

			// ---
			infoDiv.style.transition = "none";
			infoDiv.style.transform = "translateY(" + (direction === "down" ? "+" : "-") + "15%)";

			infoDiv.style.transition = "transform 500ms ease, opacity 500ms ease";
			infoDiv.style.transform = "translateY(0%)";
			infoDiv.style.opacity = "1";
		}, 500);
	}
}

function formatDate(date) {
	const dateObj = new Date(date);

	// Extract day, month, and year components
	const day = dateObj.getDate();
	const month = dateObj.toLocaleString("default", { month: "long" });
	const year = dateObj.getFullYear();

	// Create the formatted string
	return `${day} ${month} ${year}`;
}
